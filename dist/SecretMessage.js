function Z(e){window.enmity.plugins.registerPlugin(e)}function O(e){return window.enmity.plugins.getPlugin(e)}const I=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets;const B=window.enmity.modules.common.Messages;window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const l=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const ee=window.enmity.modules.common.Toasts;window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const te=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const V=window.enmity.modules.common.Linking,ne=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:o}=window.enmity;o.Alert,o.Button,o.FlatList;const oe=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal;const re=o.Pressable;o.RefreshControl;const se=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const F=o.Text;o.TextInput,o.TouchableHighlight,o.TouchableOpacity,o.TouchableWithoutFeedback,o.Touchable;const j=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const ie=o.FormInput;o.FormLabel,o.FormRadio;const c=o.FormRow,T=o.FormSection;o.FormSelect,o.FormSubLabel;const x=o.FormSwitch;o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;const $={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,t)=>window.enmity.modules.filters.byName(e,t),byTypeName:(e,t)=>window.enmity.modules.filters.byTypeName(e,t),byDisplayName:(e,t)=>window.enmity.modules.filters.byDisplayName(e,t)};function le(e,t){return window.enmity.modules.getModule(e,t)}function ae(...e){return window.enmity.modules.bulk(...e)}function p(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function ce(e,t,n){return window.enmity.utilities.findInReactTree(e,t,n)}function ue(e){return window.enmity.assets.getByID(e)}function m(e){return window.enmity.assets.getIDByName(e)}function me(e){return window.enmity.patcher.create(e)}var u="SecretMessage",K="1.0.3",de="Send secret message that only your friend can understand.",ge=[{name:"mafu",id:"519760564755365888"}],we="#008b8b",fe={name:u,version:K,description:de,authors:ge,color:we};const{native:S}=window.enmity;function he(){S.reload()}S.version,S.build,S.device,S.version;const ye=m("ic_lock"),be=m("ic_gift"),Se=m("ic_dm_user"),ve=m("ic_message_retry"),Ee=m("img_account_sync_github_white"),_e=m("Discord"),Me=m("img_account_sync_twitter_white"),ke=p("acceptInviteAndTransitionToInviteChannel");var Ie=({settings:e})=>{const t=ne.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:I.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:I.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:I.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return l.createElement(se,null,l.createElement(j,{style:t.container},l.createElement(oe,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:t.image}),l.createElement(j,{style:t.title},l.createElement(F,{style:t.name},"SecretMessage"),l.createElement(F,{style:t.author},"by mafu"))),l.createElement(T,{title:"SETTING"},l.createElement(ie,{title:"Key",placeholder:"Input key you shared with your friend",value:e.get("key"),onSubmitEditing:n=>{e.set("key",n.nativeEvent.text)}}),l.createElement(c,{label:"Enable encryption",subLabel:"You can also enable it by tapping on the button in chat input if you enable the option below.",leading:l.createElement(c.Icon,{source:ye}),trailing:l.createElement(x,{value:e.getBoolean("enabled",!1),onValueChange:n=>{e.set("enabled",n)}})}),l.createElement(c,{label:"Hijack gift button",subLabel:"Hijack useless gift button and change it to useful button :p",leading:l.createElement(c.Icon,{source:be}),trailing:l.createElement(x,{value:e.getBoolean("hijack_gift",!1),onValueChange:n=>{e.set("hijack_gift",n)}})}),l.createElement(c,{label:"Auto shorten text",subLabel:"Shorten encrypted text by replacing specific char. You can try disabling it if you are being detected by automod :D",leading:l.createElement(c.Icon,{source:Se}),trailing:l.createElement(x,{value:e.getBoolean("shorten_text",!0),onValueChange:n=>{e.set("shorten_text",n)}})}),l.createElement(c,{label:"Reload Discord",trailing:c.Arrow,leading:l.createElement(c.Icon,{source:ve}),subLabel:"You need to reload Discord if you wanna apply changes to loaded messages too.",onPress:()=>{he()}})),l.createElement(T,{title:"INFORMATION"},l.createElement(c,{label:"Follow me on Twitter",style:t.info,trailing:c.Arrow,leading:l.createElement(c.Icon,{source:Me}),onPress:()=>{V.openURL("https://twitter.com/m4fn3")}}),l.createElement(c,{label:"Visit my server for help",style:t.info,trailing:c.Arrow,leading:l.createElement(c.Icon,{source:_e}),onPress:()=>{ke.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{te.pop()}})}}),l.createElement(c,{label:"Check Source on GitHub",style:t.info,trailing:c.Arrow,leading:l.createElement(c.Icon,{source:Ee}),onPress:()=>{V.openURL("https://github.com/m4fn3/SecretMessage")}})),l.createElement(F,{style:t.footer},`v${K}`))};const Be=le(e=>{var t,n,r;return(r=(n=(t=e._dispatcher)==null?void 0:t._actionHandlers)==null?void 0:n._dependencyGraph)==null?void 0:r.nodes}),D=Be._dispatcher._actionHandlers._dependencyGraph.nodes;function Fe(e){let t=Object.keys(D).filter(n=>D[n].name===e);if(t.length)return D[t[0]].actionHandler}function _(e,t,n){window.enmity.settings.set(e,t,n)}function d(e,t,n){return window.enmity.settings.get(e,t,n)}let Y="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";function N(e,t){let n="";for(let r=0;r<e.length;r++)n+=String.fromCharCode(e.charCodeAt(r)^t.charCodeAt(r%t.length));return n}function z(e){return`${N("secret",e).slice(0,3).padStart(3,"?")}`}function q(e){return`\`<${e.slice(0,2)}${"*".repeat(Math.max(e.length-2,0))}>\``}function xe(e,t,n){const r=e.slice(0,t),s=e.slice(t);return`${r}${n}${s}`}function $e(e,t){const n=e.slice(0,t),r=e.slice(t+1);return`${n}${r}`}function De(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function M(){return Y[De(0,Y.length-1)]}function W(e){let t=d(u,"key"),n=Pe(N(e,t)),r=Math.floor(n.length/3),s=z(t);return r==0?n=`${s}${n}`:[3,2,1].forEach(a=>{n=xe(n,r*a-1,s[a-1])}),`${M()}${M()}${n}${M()}${M()}`}function Ne(e,t){let n=2;if(e.length<=9){if(e.slice(2,5)==t)return e.slice(5,-2)}else{let r=Math.floor((e.length-n*2-3)/3),s=`${e[r-1+(1-1)+n]}${e[r*2-1+(2-1)+n]}${e[r*3-1+(3-1)+n]}`;if(e=e.slice(2,-2),t==s)return[3,2,1].forEach(a=>{e=$e(e,r*a-1+(a-1))}),e}return!1}function R(e){let t=d(u,"key"),n=z(t),r=q(t),s=Ne(e,n);return s?`${N(Re(s),t)} ${r}`:e}function Re(e){return e.replaceAll("\u2004","\r").replaceAll("\u2001",`
`).replaceAll("\u2002","\v").replaceAll("\u2003","\f")}function Pe(e){return d(u,"shorten_text")?e.replaceAll("\v","\u2002").replaceAll("\f","\u2003").replaceAll("\r","\u2004").replaceAll(`
`,"\u2001"):e}var J;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(J||(J={}));var P;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(P||(P={}));var L;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(L||(L={}));var Q;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(Q||(Q={}));var C;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(C||(C={}));var X;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(X||(X={}));const Le=m("img_nitro_star"),Ce={id:"secret",name:"secret",displayName:"secret",description:"Set key of SecretMessage",displayDescription:"Set key of SecretMessage",type:P.Chat,inputType:L.BuiltInText,options:[{name:"key",displayName:"key",description:"new key",displayDescription:"new key",type:C.String,required:!0}],execute:async function(e,t){let n=e[e.findIndex(r=>r.name==="key")].value;_(u,"key",n),ee.open({content:`Successfully set new key to ${n}`,source:Le})}},g=me("SecretMessage"),[G]=[Fe("MessageStore")],[U,Ge,Ue]=ae($.byProps("openSystemKeyboard"),$.byName("ChatInput",!1),$.byProps("getAssetUriForEmbed")),Ae=m("ic_show_password"),He=m("ic_hide_password"),Ve=p("View"),{DCDChatManager:je}=Ve.NativeModules;function Te(e,t,n=!1){(n||d(u,e)===void 0)&&_(u,e,t)}const pe={...fe,onStart(){this.commands=[Ce],[["enabled",!1],["key","default"],["hijack_gift",!0],["shorten_text",!0]].forEach(r=>{Te(...r)}),O("HideGiftButton")&&window.enmity.plugins.disablePlugin("HideGiftButton");let e=null,t=m("ic_send"),n="#5865f2";g.after(re.type,"render",(r,s,a)=>{var i,w,h,f,y,v,A;if(typeof((h=(w=(i=a.props)==null?void 0:i.children[0])==null?void 0:w.props)==null?void 0:h.source)=="number"){let E=a.props.children[0].props.source,b=null;if(e&&E==e)b="gift";else if(E==t)b="send";else if(!e&&ue(E).httpServerLocation==="/assets/modules/chat_input/native/images")e=E,b="gift";else return;if(b=="gift")a.props.children[0].props.source=d(u,"enabled")?He:Ae,s[0].onPress=()=>{_(u,"enabled",!d(u,"enabled")),U.setText(""),U.openSystemKeyboard(),U.dismissKeyboard()};else if(b=="send"){let H=(y=(f=a.props)==null?void 0:f.style[0][1])!=null&&y.backgroundColor?1:2,k=(A=(v=a.props)==null?void 0:v.style[0][H])==null?void 0:A.backgroundColor;k&&k!="#e74c3c"&&(n=k),a.props.style[0][H].backgroundColor=d(u,"enabled")?"#e74c3c":n}}}),g.after(Ge.default.prototype,"render",(r,s,a)=>{let i=ce(a,w=>{var h;return(h=w.props)==null?void 0:h.placeholder});i&&(i.props.placeholder=d(u,"enabled")?"Send *secret* message":"Send normal message")}),g.before(je,"updateRows",(r,s,a)=>{var i,w;const h=JSON.parse(s[1]);for(const f of h)if(((i=f.message)==null?void 0:i.content)&&Array.isArray((w=f.message)==null?void 0:w.content)){let y=f.message.content[f.message.content.length-1];if(y.type==="inlineCode"&&y.content.startsWith("<")&&y.content.endsWith(">")){let v=y.content.slice(1,-1);f.message.content[f.message.content.length-1]={type:"channelMention",content:[{type:"channel",content:[{type:"text",content:v}],icon:Ue.getAssetUriForEmbed(m("ic_channel_lock_16px"))}]}}}s[1]=JSON.stringify(h)}),g.before(G,"LOAD_MESSAGES_SUCCESS",(r,s,a)=>{s[0].messages=s[0].messages.map(i=>(i.content=i.content?R(i.content):i.content,i))}),g.before(G,"MESSAGE_CREATE",(r,s,a)=>{let i=s[0].message.content;s[0].message.content=i&&R(i)}),g.before(G,"MESSAGE_UPDATE",(r,s,a)=>{let i=s[0].message.content;s[0].message.content=i&&R(i)}),g.before(B,"sendMessage",(r,s,a)=>{if(d(u,"enabled")){let i=s[1].content;s[1].content=i&&W(i)}}),g.before(B,"editMessage",(r,s,a)=>{if(d(u,"enabled")){let i=s[2].content;s[2].content=i&&W(i)}}),g.before(B,"startEditMessage",(r,s,a)=>{let i=d(u,"key"),w=q(i);s[2]=s[2].replace(w,"")})},onStop(){this.commands=[],g.unpatchAll()},getSettingsPanel({settings:e}){return l.createElement(Ie,{settings:e})}};Z(pe);
