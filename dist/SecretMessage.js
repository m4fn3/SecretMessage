function J(e){window.enmity.plugins.registerPlugin(e)}function Q(e){return window.enmity.plugins.getPlugin(e)}const M=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets;const k=window.enmity.modules.common.Messages;window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const l=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const X=window.enmity.modules.common.Toasts;window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const Z=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const G=window.enmity.modules.common.Linking,p=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:n}=window.enmity;n.Alert,n.Button,n.FlatList;const O=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal;const ee=n.Pressable;n.RefreshControl;const te=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const _=n.Text;n.TextInput,n.TouchableHighlight,n.TouchableOpacity,n.TouchableWithoutFeedback,n.Touchable;const H=n.View;n.VirtualizedList,n.Form,n.FormArrow,n.FormCTA,n.FormCTAButton,n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon;const ne=n.FormInput;n.FormLabel,n.FormRadio;const a=n.FormRow,C=n.FormSection;n.FormSelect,n.FormSubLabel;const U=n.FormSwitch;n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;const V={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,t)=>window.enmity.modules.filters.byName(e,t),byTypeName:(e,t)=>window.enmity.modules.filters.byTypeName(e,t),byDisplayName:(e,t)=>window.enmity.modules.filters.byDisplayName(e,t)};function oe(e,t){return window.enmity.modules.getModule(e,t)}function re(...e){return window.enmity.modules.bulk(...e)}function se(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function ie(e,t,o){return window.enmity.utilities.findInReactTree(e,t,o)}function le(e){return window.enmity.assets.getByID(e)}function m(e){return window.enmity.assets.getIDByName(e)}function ce(e){return window.enmity.patcher.create(e)}var u="SecretMessage",j="1.0.1",ae="Send secret message that only your friend can understand.",ue=[{name:"mafu",id:"519760564755365888"}],me="#008b8b",de={name:u,version:j,description:ae,authors:ue,color:me};const{native:y}=window.enmity;function ge(){y.reload()}y.version,y.build,y.device,y.version;const we=m("ic_lock"),fe=m("ic_gift"),he=m("ic_message_retry"),ye=m("img_account_sync_github_white"),be=m("Discord"),Se=m("img_account_sync_twitter_white"),ve=se("acceptInviteAndTransitionToInviteChannel");var Ee=({settings:e})=>{const t=p.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:M.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:M.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:M.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return l.createElement(te,null,l.createElement(H,{style:t.container},l.createElement(O,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:t.image}),l.createElement(H,{style:t.title},l.createElement(_,{style:t.name},"SecretMessage"),l.createElement(_,{style:t.author},"by mafu"))),l.createElement(C,{title:"SETTING"},l.createElement(ne,{title:"Key",placeholder:"Input key you shared with your friend",value:e.get("key"),onSubmitEditing:o=>{e.set("key",o.nativeEvent.text)}}),l.createElement(a,{label:"Enable encryption",subLabel:"You can also enable it by tapping on the button in chat input if you enable the option below.",leading:l.createElement(a.Icon,{source:we}),trailing:l.createElement(U,{value:e.getBoolean("enabled",!1),onValueChange:o=>{e.set("enabled",o)}})}),l.createElement(a,{label:"Hijack gift button",subLabel:"Hijack useless gift button and change it to useful button :p",leading:l.createElement(a.Icon,{source:fe}),trailing:l.createElement(U,{value:e.getBoolean("hijack_gift",!1),onValueChange:o=>{e.set("hijack_gift",o)}})}),l.createElement(a,{label:"Reload Discord",trailing:a.Arrow,leading:l.createElement(a.Icon,{source:he}),subLabel:"You need to reload Discord if you wanna apply changes to loaded messages too.",onPress:()=>{ge()}})),l.createElement(C,{title:"INFORMATION"},l.createElement(a,{label:"Follow me on Twitter",style:t.info,trailing:a.Arrow,leading:l.createElement(a.Icon,{source:Se}),onPress:()=>{G.openURL("https://twitter.com/m4fn3")}}),l.createElement(a,{label:"Visit my server for help",style:t.info,trailing:a.Arrow,leading:l.createElement(a.Icon,{source:be}),onPress:()=>{ve.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{Z.pop()}})}}),l.createElement(a,{label:"Check Source on GitHub",style:t.info,trailing:a.Arrow,leading:l.createElement(a.Icon,{source:ye}),onPress:()=>{G.openURL("https://github.com/m4fn3/SecretMessage")}})),l.createElement(_,{style:t.footer},`v${j}`))};const Me=oe(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),I=Me._dispatcher._actionHandlers._dependencyGraph.nodes;function ke(e){let t=Object.keys(I).filter(o=>I[o].name===e);if(t)return I[t[0]].actionHandler}function S(e,t,o){window.enmity.settings.set(e,t,o)}function d(e,t,o){return window.enmity.settings.get(e,t,o)}let T="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";function B(e,t){let o="";for(let r=0;r<e.length;r++)o+=String.fromCharCode(e.charCodeAt(r)^t.charCodeAt(r%t.length));return o}function K(e){return`${B("secret",e).slice(0,3).padStart(3,"?")}`}function A(e){return`\`<${e.slice(0,2)}${"*".repeat(Math.max(e.length-2,0))}>\``}function _e(e,t,o){const r=e.slice(0,t),s=e.slice(t);return`${r}${o}${s}`}function Ie(e,t){const o=e.slice(0,t),r=e.slice(t+1);return`${o}${r}`}function Be(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function v(){return T[Be(0,T.length-1)]}function z(e){let t=d(u,"key"),o=Re(B(e,t)),r=Math.floor(o.length/3),s=K(t);return r==0?o=`${s}${o}`:[3,2,1].forEach(c=>{o=_e(o,r*c-1,s[c-1])}),`${v()}${v()}${o}${v()}${v()}`}function Fe(e,t){let o=2;if(e.length<=9){if(e.slice(2,5)==t)return e.slice(5,-2)}else{let r=Math.floor((e.length-o*2-3)/3),s=`${e[r-1+(1-1)+o]}${e[r*2-1+(2-1)+o]}${e[r*3-1+(3-1)+o]}`;if(e=e.slice(2,-2),t==s)return[3,2,1].forEach(c=>{e=Ie(e,r*c-1+(c-1))}),e}return!1}function F(e){let t=d(u,"key"),o=K(t),r=A(t),s=Fe(e,o);return s?`${B($e(s),t)} ${r}`:e}function $e(e){return e.replaceAll("\u2004","\r").replaceAll("\u2001",`
`).replaceAll("\u2002","\v").replaceAll("\u2003","\f")}function Re(e){return e.replaceAll("\v","\u2002").replaceAll("\f","\u2003").replaceAll("\r","\u2004").replaceAll(`
`,"\u2001")}var Y;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(Y||(Y={}));var $;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})($||($={}));var R;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(R||(R={}));var q;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(q||(q={}));var D;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(D||(D={}));var W;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(W||(W={}));const De=m("img_nitro_star"),Ne={id:"secret",name:"secret",displayName:"secret",description:"Set key of SecretMessage",displayDescription:"Set key of SecretMessage",type:$.Chat,inputType:R.BuiltInText,options:[{name:"key",displayName:"key",description:"new key",displayDescription:"new key",type:D.String,required:!0}],execute:async function(e,t){let o=e[e.findIndex(r=>r.name==="key")].value;S(u,"key",o),X.open({content:`Successfully set new key to ${o}`,source:De})}},g=ce("SecretMessage"),[N]=[ke("MessageStore")],[P,Pe]=re(V.byProps("openSystemKeyboard"),V.byName("ChatInput",!1)),xe=m("ic_show_password"),Le=m("ic_hide_password");function Ge(e,t,o=!1){(o||d(u,e)===void 0)&&S(u,e,t)}const He={...de,onStart(){this.commands=[Ne],[["enabled",!1],["key","default"],["hijack_gift",!0]].forEach(r=>{Ge(...r)}),Q("HideGiftButton")&&window.enmity.plugins.disablePlugin("HideGiftButton");let e=null,t=m("ic_send"),o="#5865f2";g.after(ee.type,"render",(r,s,c)=>{var i,w,f,x,L;if(typeof((f=(w=(i=c.props)==null?void 0:i.children[0])==null?void 0:w.props)==null?void 0:f.source)=="number"){let b=c.props.children[0].props.source,h=null;if(e&&b==e)h="gift";else if(b==t)h="send";else if(!e&&le(b).httpServerLocation==="/assets/modules/chat_input/native/images")e=b,h="gift";else return;if(h=="gift")c.props.children[0].props.source=d(u,"enabled")?Le:xe,s[0].onPress=()=>{S(u,"enabled",!d(u,"enabled")),P.setText(""),P.openSystemKeyboard(),P.dismissKeyboard()};else if(h=="send"){let E=(L=(x=c.props)==null?void 0:x.style[0][1])==null?void 0:L.backgroundColor;E&&E!="#e74c3c"&&(o=E),c.props.style[0][1].backgroundColor=d(u,"enabled")?"#e74c3c":o}}}),g.after(Pe.default.prototype,"render",(r,s,c)=>{let i=ie(c,w=>{var f;return(f=w.props)==null?void 0:f.placeholder});i&&(i.props.placeholder=d(u,"enabled")?"Send *secret* message":"Send normal message")}),g.before(N,"LOAD_MESSAGES_SUCCESS",(r,s,c)=>{s[0].messages=s[0].messages.map(i=>(i.content=i.content?F(i.content):i.content,i))}),g.before(N,"MESSAGE_CREATE",(r,s,c)=>{let i=s[0].message.content;s[0].message.content=i&&F(i)}),g.before(N,"MESSAGE_UPDATE",(r,s,c)=>{let i=s[0].message.content;s[0].message.content=i&&F(i)}),g.before(k,"sendMessage",(r,s,c)=>{if(d(u,"enabled")){let i=s[1].content;s[1].content=i&&z(i)}}),g.before(k,"editMessage",(r,s,c)=>{if(d(u,"enabled")){let i=s[2].content;s[2].content=i&&z(i)}}),g.before(k,"startEditMessage",(r,s,c)=>{let i=d(u,"key"),w=A(i);s[2]=s[2].replace(w,"")})},onStop(){this.commands=[],g.unpatchAll()},getSettingsPanel({settings:e}){return l.createElement(Ee,{settings:e})}};J(He);
